"""
Phase 2: åˆ†æãƒ¬ãƒãƒ¼ãƒˆæ§‹é€ åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
Phase 1ã§åé›†ã•ã‚ŒãŸJSONãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãã€
æ§‹é€ åŒ–ã•ã‚ŒãŸMarkdownå½¢å¼ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã€‚ï¼ˆã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆè¦–ç‚¹ï¼‰
"""
import os
import sys
import json
import traceback
from datetime import datetime

from langchain_core.messages import HumanMessage
from langchain_google_genai import ChatGoogleGenerativeAI

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
from config_loader import get_config

def generate_analysis_report(target_year: int = None):
    """åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹"""
    print("\n" + "=" * 60)
    print("ğŸ§  Phase 2: åˆ†æãƒ¬ãƒãƒ¼ãƒˆæ§‹é€ åŒ–ã‚’é–‹å§‹")
    print("=" * 60)

    # --- 0. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ ---
    config = get_config()

    # --- 1. ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª ---
    google_api_key = os.environ.get("GOOGLE_API_KEY")
    if not google_api_key:
        print("âŒ ã‚¨ãƒ©ãƒ¼: GOOGLE_API_KEYãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
        sys.exit(1)

    # --- 2. JSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ ---
    research_data_path = config.get("data.research_data_path", "reports/research_data.json")
    if not os.path.exists(research_data_path):
        print(f"âŒ ã‚¨ãƒ©ãƒ¼: æ¤œç´¢ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {research_data_path}")
        print("Phase 1 (research_searcher.py)ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        sys.exit(1)

    with open(research_data_path, "r", encoding="utf-8") as f:
        raw_data = json.load(f)

    if not raw_data:
        print("âš ï¸ è­¦å‘Š: JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã€‚")
        sys.exit(0)

    # JSONãƒ‡ãƒ¼ã‚¿ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«çµ„ã¿è¾¼ã‚€ãŸã‚ã«æ–‡å­—åˆ—åŒ–
    data_string = json.dumps(raw_data, indent=2, ensure_ascii=False)

    print(f"âœ“ {len(raw_data)}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚")

    # --- 3. LLMã®æº–å‚™ ---
    model = ChatGoogleGenerativeAI(
        model=config.get("llm.analyzer.model", "gemini-2.5-flash"),
        temperature=config.get("llm.analyzer.temperature", 0.1),
    )
    print("âœ“ LLMã‚’è¨­å®šã—ã¾ã—ãŸ")

    # --- 4. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å®šç¾©ï¼ˆçµŒå–¶å±¤å‘ã‘æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆï¼‰ ---
    analysis_prompt = f"""
ã‚ãªãŸã¯è£½é€ æ¥­ã®çµŒå–¶å±¤å‘ã‘ã«ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹**äººææˆ¦ç•¥ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ**ã§ã‚ã‚‹ã€‚
æä¾›ã•ã‚ŒãŸJSONå½¢å¼ã®èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€çµŒå–¶å±¤ãŒ**5åˆ†ä»¥å†…ã§å…¨ä½“åƒã‚’ç†è§£ã§ãã‚‹æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆ**ã‚’Markdownå½¢å¼ã§ä½œæˆã›ã‚ˆã€‚

---

# ğŸ“„ å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ (JSON)
---
{data_string}
---

# ğŸ¯ å‡ºåŠ›æ–¹é‡
- é›£è§£ãªå°‚é–€ç”¨èªã‚„è‹±èªè¡¨ç¾ã‚’é¿ã‘ã€çµŒå–¶å±¤ãŒç›´æ„Ÿçš„ã«ç†è§£ã§ãã‚‹å¹³æ˜“ãªæ—¥æœ¬èªã§æ›¸ãã€‚
- ã€Œä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã€ã€Œä½•ã‚’æ„å‘³ã™ã‚‹ã‹ã€ã«é›†ä¸­ã—ã€ã€Œã©ã†ã™ã¹ãã‹ã€ã‚„è¡Œå‹•ææ¡ˆã¯ä¸è¦ã§ã‚ã‚‹ã€‚
- å†…å®¹ã¯A4æ›ç®—ã§ç´„2ãƒšãƒ¼ã‚¸ä»¥å†…ï¼ˆ2,000ã€œ2,500æ–‡å­—ï¼‰ã¨ã™ã‚‹ã€‚
- å‡ºå…¸ãƒ»URLãƒ»å…¬é–‹æ—¥ãƒ»åª’ä½“åã¯å¿…ãšè¨˜è¼‰ã™ã‚‹ã€‚

---

# ğŸ“‹ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

## 1. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ï¼ˆæ¦‚è¦ï¼‰
ä»Šé€±ã®èª¿æŸ»ã‹ã‚‰æµ®ã‹ã³ä¸ŠãŒã£ãŸå…¨ä½“çš„ãªå‚¾å‘ãƒ»ç¤ºå”†ã‚’3ã€œ5æ–‡ã§è¨˜è¿°ã™ã‚‹ã€‚

**è¨˜è¿°ä¾‹**ï¼š
ã€ŒAIã«ã‚ˆã‚‹æ¥­å‹™å¤‰é©ãŒåŠ é€Ÿã™ã‚‹ä¸­ã€è£½é€ æ¥­ã§ã‚‚"ã‚¹ã‚­ãƒ«ã‚’è»¸ã«ã—ãŸäººææˆ¦ç•¥"ãŒç«¶äº‰å„ªä½ã®éµã¨ãªã‚Šã¤ã¤ã‚ã‚‹ã€‚å¾“æ¥ã®è·å‹™è¨˜è¿°æ›¸ã«ä¾å­˜ã—ãŸé…ç½®ã‹ã‚‰ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ã‚¹ã‚­ãƒ«ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã«åŸºã¥ãæŸ”è»Ÿãªäººææ´»ç”¨ãŒé€²ã‚“ã§ã„ã‚‹ã€‚ã€

**è¦ä»¶**ï¼š
- ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã‚’ä¿¯ç°ã—ãŸå¤§ããªãƒˆãƒ¬ãƒ³ãƒ‰ã‚’è¨˜è¿°
- è£½é€ æ¥­ã¸ã®å½±éŸ¿ã‚’æ„è­˜ã—ãŸè¡¨ç¾
- 3ã€œ5æ–‡ã§ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã¾ã¨ã‚ã‚‹

---

## 2. ä»Šé€±ã®æ³¨ç›®ãƒˆãƒ”ãƒƒã‚¯ï¼ˆ3é …ç›®ï¼‰
åé›†ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã‹ã‚‰ã€çµŒå–¶å±¤ãŒæŠ¼ã•ãˆã‚‹ã¹ãä¸»è¦ãƒˆãƒ”ãƒƒã‚¯ã‚’3ã¤é¸å®šã—ã€ä»¥ä¸‹ã®å½¢å¼ã§æ•´ç†ã™ã‚‹ã€‚

### ãƒˆãƒ”ãƒƒã‚¯1ï¼šï¼»20æ–‡å­—ä»¥å†…ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼½
- **å†…å®¹**ï¼ˆ2ã€œ3æ–‡ã§è¦ç´„ï¼‰
  [å…·ä½“çš„ãªå‹•ãã€ä¼æ¥­åã€æ•°å€¤ãŒã‚ã‚Œã°è¨˜è¼‰]

- **çµŒå–¶çš„ç¤ºå”†**ï¼ˆ1ã€œ2æ–‡ï¼‰
  [ã“ã®å‹•å‘ãŒçµŒå–¶ã‚„äººææˆ¦ç•¥ã«ã©ã†å½±éŸ¿ã™ã‚‹ã‹ã‚’è¨˜è¿°]

**å‡ºå…¸**ï¼š[è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«]ï½œ[åª’ä½“å]ï½œ[å…¬é–‹æ—¥ï¼šYYYY-MM-DD]ï½œURL: [URL]

### ãƒˆãƒ”ãƒƒã‚¯2ï¼šï¼»åŒæ§˜ã«ï¼½
ï¼ˆå½¢å¼ã¯åŒã˜ï¼‰

### ãƒˆãƒ”ãƒƒã‚¯3ï¼šï¼»åŒæ§˜ã«ï¼½
ï¼ˆå½¢å¼ã¯åŒã˜ï¼‰

**é¸å®šåŸºæº–**ï¼š
- è£½é€ æ¥­ã«ç›´æ¥é–¢é€£æ€§ãŒé«˜ã„ã‚‚ã®
- å…·ä½“çš„ãªä¼æ¥­äº‹ä¾‹ã‚„æ•°å€¤ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‚‚ã®
- çµŒå–¶åˆ¤æ–­ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã‚‚ã®

---

## 3. è£½é€ æ¥­ã¸ã®ç¤ºå”†ï¼ˆçµŒå–¶å±¤å‘ã‘è¦ç´„ï¼‰
DXãƒ»äººææˆ¦ç•¥ãƒ»ã‚¹ã‚­ãƒ«ç®¡ç†ã®è¦³ç‚¹ã‹ã‚‰ã€ä»Šå›ã®ãƒˆãƒ¬ãƒ³ãƒ‰ãŒè£½é€ æ¥­ã«ä¸ãˆã‚‹æ„å‘³ã‚’1æ®µè½ï¼ˆç´„5ã€œ6æ–‡ï¼‰ã§ã¾ã¨ã‚ã‚‹ã€‚

**è¨˜è¿°ä¾‹**ï¼š
ã€Œã‚¹ã‚­ãƒ«ç®¡ç†ã®ç²¾åº¦ãŒçµŒå–¶ãƒªã‚¹ã‚¯ç®¡ç†ã®ä¸€éƒ¨ã«ãªã‚Šã¤ã¤ã‚ã‚‹ã€‚ç†Ÿç·´å·¥ã®çŸ¥è­˜ã‚’AIã¨çµ±åˆã™ã‚‹ä¼æ¥­ãŒç«¶äº‰å„ªä½ã‚’ç¯‰ãå‚¾å‘ãŒå¼·ã¾ã£ã¦ã„ã‚‹ã€‚ä¸€æ–¹ã§ã€ã‚¹ã‚­ãƒ«å¯è¦–åŒ–ã®é…ã‚Œã¯äººæé…ç½®ã®ç¡¬ç›´åŒ–ã‚’æ‹›ãã€ç”Ÿç”£æ€§ä½ä¸‹ãƒªã‚¹ã‚¯ã¨ãªã‚‹ã€‚Industry 4.0ã¸ã®å¯¾å¿œã«ãŠã„ã¦ã‚‚ã€ã‚¹ã‚­ãƒ«ãƒ™ãƒ¼ã‚¹ã®äººææˆ¦ç•¥ãŒå‰ææ¡ä»¶ã¨ãªã£ã¦ã„ã‚‹ã€‚çŸ­æœŸçš„ã«ã¯æ—¢å­˜ã®ã‚¹ã‚­ãƒ«ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã®ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã€ä¸­æœŸçš„ã«ã¯AIã‚’æ´»ç”¨ã—ãŸå‹•çš„ã‚¹ã‚­ãƒ«ç®¡ç†ã¸ã®ç§»è¡ŒãŒç«¶äº‰åŠ›ç¶­æŒã®éµã¨ãªã‚‹ã€‚ã€

**è¦ä»¶**ï¼š
- è£½é€ æ¥­ç‰¹æœ‰ã®èª²é¡Œï¼ˆç†Ÿç·´å·¥æŠ€èƒ½ä¼æ‰¿ã€å¤šèƒ½å·¥åŒ–ã€å®‰å…¨æ€§ç­‰ï¼‰ã¨ã®é–¢é€£ã‚’è¨˜è¿°
- çŸ­æœŸãƒ»ä¸­æœŸã®ç¤ºå”†ã‚’å«ã‚ã‚‹
- å®šé‡çš„ãªè¡¨ç¾ï¼ˆä¾‹ï¼šã€‡ï¼…å¢—ã€åŠå¹´ä»¥å†…ãªã©ï¼‰ã‚’ç©æ¥µçš„ã«ä½¿ç”¨
- 5ã€œ6æ–‡ã§ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã¾ã¨ã‚ã‚‹

---

## 4. èª¿æŸ»å‡ºå…¸ä¸€è¦§ï¼ˆã™ã¹ã¦è¨˜è¼‰ï¼‰
èª¿æŸ»ã«ä½¿ç”¨ã—ãŸå…¨ã¦ã®å‡ºå…¸æƒ…å ±ã‚’æ¬¡ã®å½¢å¼ã§åˆ—æŒ™ã™ã‚‹ã€‚
å„å‡ºå…¸ã¯å¿…ãš**URLãƒ»åª’ä½“åãƒ»å…¬é–‹æ—¥ãƒ»ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢**ã‚’å«ã‚€ã€‚

**ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ãŒ0.5ä»¥ä¸Šã®å‡ºå…¸ã‚’å…¨ã¦è¨˜è¼‰ã™ã‚‹ã€‚**

### å‡ºå…¸ [é€£ç•ª]
- **è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«**ï½œ**åª’ä½“å**ï½œ**å…¬é–‹æ—¥ï¼šYYYY-MM-DD**ï½œ**åœ°åŸŸï¼šå›½å**ï½œ**ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ï¼šX.X**
  **URL**: [URL]
  **è¦ç´„**ï¼š[1ã€œ2æ–‡ã§è¨˜äº‹å†…å®¹ã®è¦ç‚¹ã‚’è¨˜è¼‰]
  **è£½é€ æ¥­é–¢é€£**ï¼šâœ“ ã‚ã‚Š / - ãªã—

ï¼ˆå‡ºå…¸ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯å…¨ä»¶ã‚’åŒå½¢å¼ã§åˆ—æŒ™ã€‚ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ãŒ0.5æœªæº€ã®ã‚‚ã®ã¯é™¤å¤–ã™ã‚‹ã€‚ï¼‰

**è¨˜è¼‰é †åº**ï¼š
1. ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ã®é«˜ã„é †ã«è¨˜è¼‰
2. åŒã‚¹ã‚³ã‚¢ã®å ´åˆã¯å…¬é–‹æ—¥ãŒæ–°ã—ã„é †

---

# âœï¸ ãƒˆãƒ¼ãƒ³ãƒ»æ–‡ä½“
- ã€Œã§ã™ï¼ã¾ã™ã€ã§ã¯ãªãã€**ã€Œã§ã‚ã‚‹ã€èª¿**ã§è¨˜è¿°ã™ã‚‹ã€‚
- å®šé‡çš„ãªè¡¨ç¾ï¼ˆä¾‹ï¼šã€‡ï¼…å¢—ã€åŠå¹´ä»¥å†…ãªã©ï¼‰ã‚’ç©æ¥µçš„ã«ä½¿ç”¨ã™ã‚‹ã€‚
- å›³è¡¨ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»æŒ‡ç¤ºè¡¨ç¾ã¯ä¸è¦ã§ã‚ã‚‹ã€‚
- çµŒå–¶ä¼šè­°è³‡æ–™ã¨ã—ã¦ãã®ã¾ã¾å¼•ç”¨å¯èƒ½ãªæ–‡ä½“ã§æ›¸ãã€‚
- å°‚é–€ç”¨èªã¯å¯èƒ½ãªé™ã‚Šå¹³æ˜“ãªè¨€è‘‰ã«è¨€ã„æ›ãˆã‚‹ã€‚

---

# ğŸ¯ ç›®çš„
çµŒå–¶å±¤ãŒ**"ä½•ãŒèµ·ãã¦ã„ã‚‹ã®ã‹"ã‚’ä¸€èª­ã§ç†è§£ã—ã€æˆ¦ç•¥ä¸Šã®æ–¹å‘æ€§ã‚’åˆ¤æ–­ã§ãã‚‹**ã‚ˆã†ã«ã™ã‚‹ã€‚
è¡Œå‹•ææ¡ˆã§ã¯ãªãã€ã€Œç†è§£ãƒ»åˆ¤æ–­ã«å¿…è¦ãªæƒ…å ±ã®æ•´ç†ã€ã«å¾¹ã™ã‚‹ã“ã¨ã€‚

---

# ğŸ“ æ–‡å­—æ•°ã®ç›®å®‰
- ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ï¼š200ã€œ300æ–‡å­—
- ä»Šé€±ã®æ³¨ç›®ãƒˆãƒ”ãƒƒã‚¯ï¼ˆ3é …ç›®åˆè¨ˆï¼‰ï¼š800ã€œ1,000æ–‡å­—
- è£½é€ æ¥­ã¸ã®ç¤ºå”†ï¼š300ã€œ400æ–‡å­—
- èª¿æŸ»å‡ºå…¸ä¸€è¦§ï¼š700ã€œ800æ–‡å­—
- **åˆè¨ˆï¼š2,000ã€œ2,500æ–‡å­—**

ä¸Šè¨˜ã®æ§‹æˆã«å¾“ã£ã¦ã€Markdownå½¢å¼ã§æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã›ã‚ˆã€‚
"""

    # --- 5. LLMã®å®Ÿè¡Œ ---
    today = datetime.now()
    year = target_year or today.year
    final_report = None
    
    try:
        response = model.invoke([HumanMessage(content=analysis_prompt)])
        final_report = response.content or "ï¼ˆå†…å®¹ãªã—ï¼‰"

    except Exception as e:
        print(f"\nâŒ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
        traceback.print_exc()
        sys.exit(1)

    # --- 6. ãƒ¬ãƒãƒ¼ãƒˆã®ä¿å­˜ ---
    reports_dir = config.get("data.reports_dir", "reports")
    os.makedirs(reports_dir, exist_ok=True)
    date_str = today.strftime("%Y%m%d")

    # ãƒ•ã‚¡ã‚¤ãƒ«åãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ç”Ÿæˆ
    filename_template = config.get("report.filename_template", "é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ_{year}_{date}.md")
    file_name = os.path.join(reports_dir, filename_template.format(year=year, date=date_str))

    # ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«
    title_template = config.get("report.title_template", "é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ: ã‚¹ã‚­ãƒ«ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆãƒ»ã‚¿ãƒ¬ãƒ³ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆå‹•å‘ ({year}å¹´ç‰ˆ)")
    report_title = title_template.format(year=year)
    author = config.get("report.author", "ä¸»å¸­ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã«ã‚ˆã‚‹åˆ†æ")

    try:
        with open(file_name, "w", encoding="utf-8") as f:
            # ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆï¼ˆçµŒå–¶å±¤å‘ã‘æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆï¼‰
            header = (
                f"# {report_title}\n\n"
                f"**ä½œæˆè€…**: {author}  \n"
                f"**èª¿æŸ»å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ä»¶æ•°**: {len(raw_data)}ä»¶  \n"
                f"**ç”Ÿæˆæ—¥æ™‚**: {today.strftime('%Yå¹´%mæœˆ%dæ—¥')}  \n\n"
                f"---\n\n"
            )
            f.write(header + final_report)

        print("\n" + "=" * 60)
        print("âœ“ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†ï¼ˆçµŒå–¶å±¤å‘ã‘æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆï¼‰")
        print("=" * 60)
        print(f"ğŸ“„ ä¿å­˜å…ˆ: {file_name}")
        print(f"ğŸ“Š æ–‡å­—æ•°ç›®å®‰: 2,000ã€œ2,500æ–‡å­—")
        print("=" * 60 + "\n")
        
    except Exception as e:
        print(f"\nâŒ Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
        traceback.print_exc()
        sys.exit(1)


if __name__ == "__main__":
    year_arg = None
    if len(sys.argv) > 1:
        try:
            year_arg = int(sys.argv[1])
        except ValueError:
            print("âš ï¸ å¹´æŒ‡å®šãŒä¸æ­£ã§ã™ã€‚æ•´æ•°ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚ä¾‹: python research_analyzer.py 2026")

    generate_analysis_report(target_year=year_arg)
